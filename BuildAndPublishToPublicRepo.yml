# Ruby
# Package your Ruby project.
# Add steps that install rails, analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/ruby

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: UseRubyVersion@0
  inputs:
    versionSpec: '>= 2.5'

- task: CmdLine@2
  inputs:
    script: |
      git config --local user.name "apurvgh"
          git config --local user.email "apurv.ghai@outlook.com"
          git add .
- task: InstallSSHKey@0
  inputs:
    knownHostsEntry: '*'
    sshPublicKey: 'ssh-rsa $DOWNLOADSECUREFILE_SECUREFILEPATH'
    sshPassphrase: '$PARAPHRASE'
    sshKeySecureFile: 'deploy_key1'


- task: CmdLine@2
  inputs:
    script: |
      mkdir ~/.ssh && mv $DOWNLOADSECUREFILE_SECUREFILEPATH ~/.ssh/id_rsa
          chmod 700 ~/.ssh && chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -t rsa github.com >> ~/.ssh/known_hosts
          git remote set-url --push origin git@github.com:apurvgh@apurvgh.github.io.git
          git checkout -b users/apurvgh/$(Build.BuildNumber)
          git push origin users/apurvgh/$(Build.BuildNumber)